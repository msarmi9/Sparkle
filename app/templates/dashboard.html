{% extends "index.html" %}

{% block cards %}
	<div class="container main">
		<h3>{{ patients|length }} patients</h3>
		<br>
		<div class="progress-container">
			<div class="progress-bar-wrapper">
				<b>Overall patient adherence</b>
				<div class="progress dashboard-progress" style="height: 20px;">
				  <div class="progress-bar bg-{% if patient_adherence < 33 %}danger{% elif patient_adherence < 66 %}warning{% else %}success{% endif %}" role="progressbar"
				  	   style="width: {{ patient_adherence }}%;"
				  	   aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
				  	{{ patient_adherence }}%
				  </div>
				</div>
			</div>
			<div class="progress-bar-wrapper">
				<b>Prescription adherence</b>
				<div class="progress dashboard-progress" style="height: 20px;">
				  <div class="progress-bar bg-{% if rx_adherence < 33 %}danger{% elif rx_adherence < 66 %}warning{% else %}success{% endif %}" role="progressbar"
				  	   style="width: {{ rx_adherence }}%;"
				  	   aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
				  	{{ rx_adherence }}%
				  </div>
				</div>
			</div>
		</div>

		<ul class="nav nav-tabs" id="myTab" role="tablist">
		  <li class="nav-item">
		    <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true"
		    style="color: #dc3545;">
		    	Deviating
			</a>
		  </li>
		  <li class="nav-item">
		    <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false"
		    style="color: #17a2b8;">
		    	On track
			</a>
		  </li>
		  <li class="nav-item">
		    <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false"
		    style="color: #17a2b8;">Unprescribed</a>
		  </li>
		</ul>
		<div class="tab-content dashboard-tab-content" id="myTabContent">
		  <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
		  	<div class="card-columns card-deck">
				{% for p in nonadhering_patients %}
					<div class="card bg-light patient-card" style="width: 18rem;">
					  <div class="card-body">
					    <h5 class="card-title">{{ p.lastname }}, {{ p.firstname }}</h5>
					    <h6 class="card-subtitle mb-2 text-muted">Age: {{ p.age }}</h6>
					    <h6 class="card-subtitle mb-2 text-muted">
					    	{{ p.prescriptions|length }} prescription{{'' if p.prescriptions|length == 1 else 's' }}
						</h6>
					    <div>
					    	{% for rx in p.prescriptions %}
					    		{% if not rx.has_started() %}
					    			<span class="badge badge-pill badge-secondary">
					    				{{ rx.drug }}
					    			</span>
					    		{% else %}
					    			<span class="badge badge-pill badge-{% if not rx.is_adherent() %}danger{% else %}success{% endif %}">
					    				{{ rx.drug }}
					    			</span>
								{% endif %}
							{% endfor %}
					    </div>
					    <div style="padding-top: 10px;">
						    <a href="/patients/{{ p.id }}" class="card-link">Profile</a>
						    <a href="/patients/{{ p.id }}/new-prescription" class="card-link">New prescription</a>
						</div>
					  </div>
					</div>
				{% endfor %}
			</div>
		  </div>
		  <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
		  	<div class="card-columns card-deck">
				{% for p in adhering_patients %}
					<div class="card bg-light patient-card" style="width: 18rem;">
					  <div class="card-body">
					    <h5 class="card-title">{{ p.lastname }}, {{ p.firstname }}</h5>
					    <h6 class="card-subtitle mb-2 text-muted">Age: {{ p.age }}</h6>
					    <h6 class="card-subtitle mb-2 text-muted">
					    	{{ p.prescriptions|length }} prescription{{'' if p.prescriptions|length == 1 else 's' }}
						</h6>
					    <div>
					    	{% for rx in p.prescriptions %}
					    		{% if not rx.has_started() %}
					    			<span class="badge badge-pill badge-secondary">
					    				{{ rx.drug }}
					    			</span>
					    		{% else %}
					    			<span class="badge badge-pill badge-{% if not rx.is_adherent() %}danger{% else %}success{% endif %}">
					    				{{ rx.drug }}
					    			</span>
								{% endif %}
							{% endfor %}
					    </div>
					    <div style="padding-top: 10px;">
						    <a href="/patients/{{ p.id }}" class="card-link">Profile</a>
						    <a href="/patients/{{ p.id }}/new-prescription" class="card-link">New prescription</a>
						</div>
					  </div>
					</div>
				{% endfor %}
			</div>
		  </div>
		  <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
		  	<div class="card-columns card-deck">
				{% for p in unprescribed_patients %}
					<div class="card bg-light patient-card" style="width: 18rem;">
					  <div class="card-body">
					    <h5 class="card-title">{{ p.lastname }}, {{ p.firstname }}</h5>
					    <h6 class="card-subtitle mb-2 text-muted">Age: {{ p.age }}</h6>
					    <h6 class="card-subtitle mb-2 text-muted">
					    	{{ p.prescriptions|length }} prescription{{'' if p.prescriptions|length == 1 else 's' }}
						</h6>
					    <div>
					    	{% for rx in p.prescriptions %}
					    		{% if not rx.has_started() %}
					    			<span class="badge badge-pill badge-secondary">
					    				{{ rx.drug }}
					    			</span>
					    		{% else %}
					    			<span class="badge badge-pill badge-{% if not rx.is_adherent() %}danger{% else %}success{% endif %}">
					    				{{ rx.drug }}
					    			</span>
								{% endif %}
							{% endfor %}
					    </div>
					    <div style="padding-top: 10px;">
						    <a href="/patients/{{ p.id }}" class="card-link">Profile</a>
						    <a href="/patients/{{ p.id }}/new-prescription" class="card-link">New prescription</a>
						</div>
					  </div>
					</div>
				{% endfor %}
			</div>
		  </div>
		</div>

		<div>
			<p><a href="/new-patient">Add patient</a></p>
		</div>


	</div>
{% endblock %}